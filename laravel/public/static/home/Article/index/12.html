<!DOCTYPE html>
<html>
    <head>
        <title>文章-半透明的博客</title>
        <meta charset="utf-8">
        <link rel="icon" type="image/x-icon" href="http://www.btmblog.com/image/little_icon.png" />
        <link rel="stylesheet" type="text/css" href="http://www.btmblog.com/css/Home/common.css" />
        <style type="text/css">
            *{               
                margin: 0px;
                padding: 0px;
            }
            body{
                font-family: "Microsoft Yahei","Hiragino Sans GB","Helvetica Neue","WenQuanYi Micro Hei","\5B8B\4F53";
            }

            /*用户个人信息弹出框开始*/
            .user_info_box_id{
                overflow: hidden;
            }
            .user_info_box .user_head{
                display: inline-block;
                width: 70px;
                height: 70px;
                background-color: #f6ce5b;
                font-weight: bold;
                font-size: 14px;
                color: #FFF;
                border-radius: 35px;
                border: solid #ccc 1px;
                float: left;
                margin-left: 15px;
                margin-top: 15px;
                background-size: 70px 70px;
            }
            .user_name_history_reply{
                display: inline-block;
                width: 142px;
                height: 70px;
                float: right;
                margin-right: 15px;
                margin-top: 15px;
                overflow: hidden;
            }
            .user_nick_name{
                display: inline-block;
                width: 142px;
                height: 30px;
                line-height: 30px;
                font-size: 14px;
                overflow: hidden;
                text-overflow:ellipsis;
                white-space: nowrap;
                color: #666666;
                float: left;
            }
            .user_profile{
                display: inline-block;
                width: 100px;
                text-align: center;
                height: 30px;
                line-height: 30px;
                text-decoration: none;
                margin-top: 20px;
                margin-left: 15px;
                background: #f5ce5f;
                color: #FFF;
                border-radius: 10px;
                cursor: pointer;
            }

            .login_out_btn{
                display: inline-block;
                width: 100px;
                text-align: center;
                height: 30px;
                line-height: 30px;
                background: #ccc;
                color: #FFF;
                border-radius: 10px;
                cursor: pointer;
                margin-left: 10px;
            }
            .view_history_a,.my_reply_a{
                display: inline-block;
                width: 142px;
                height: 20px;
                line-height: 20px;
                font-size: 10px;
                overflow: hidden;
                text-overflow:ellipsis;
                white-space: nowrap;
                color: #666666;
                float: left;
                text-decoration: none;
            }
            .home_main_content{
                padding-bottom: 40px;
            }
            /*用户个人信息弹出框结束*/
        </style>
            <style>    
        .home_main_content{
            width: 1140px;
            margin:0px auto;
            min-height: 500px;
            padding-top: 20px;
            overflow: hidden;
        }
        .article_left_box{
            display: inline-block;
            width: 820px;
            margin-right: 10px;
            float: left;
        }
        

        /*文章区域样式开始*/
        .article_show_div{
            background-color: #FFF;
            border-radius: 10px;
        }
        .article_title{
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            height: 80px;
            line-height: 80px;
        }
        .article_content{
            margin-left: 20px;
            margin-right: 20px;
            margin-top: 20px;
            word-wrap: break-word; 
            word-break: normal; 
        }
        p,pre{
            overflow-x: auto;
        }

        .author_time_tags{
            overflow: hidden;
            border-bottom: #ccc 1px dotted;
        }
        .author_span{
            width: 100px;
            height: 25px;           
            float: left;
            margin-left: 20px;
            margin-right: 10px;
            overflow: hidden;
            margin-top: 12px;
        }
        .author_img{
            width: 21px;
            height: 21px;
            background:url("http://www.btmblog.com/image/home/icons.png");
            background-size:63px 63px;
            background-repeat: no-repeat;
            background-position: -21px 0px;
            float: left;
            margin-right:3px;
        }
        .author_name{
            height: 25px;
            line-height: 25px;
            font-weight: normal;
            font-size: 14px;
            color: #36353b;
            float: left;
        }
        .time_span{
            width: 200px;
            height: 25px;           
            float: left;
            margin-right: 10px;
            overflow: hidden;
            margin-top: 12px;
        }
        .time_img{
            width: 21px;
            height: 21px;
            background:url("http://www.btmblog.com/image/home/icons.png");
            background-size:63px 63px;
            background-repeat: no-repeat;
            background-position: 0px 0px;
            float: left;
            margin-right:3px;
        }
        .article_time{
            height: 25px;
            line-height: 25px;
            font-weight: normal;
            font-size: 14px;
            color: #36353b;
            float: left;
        }
        .article_tag_img{
            width: 21px;
            height: 21px;
            background:url("http://www.btmblog.com/image/home/icons.png");
            background-size:63px 63px;
            background-repeat: no-repeat;
            background-position: -42px 0px;
            float: left;
            margin-top: 12px;
        }
        .tag_a{
            display: inline-block;
            float: left;
        }
        /*文章区域样式结束*/

        /*右边栏样式开始*/
        .article_right_box{
            display: inline-block;
            width: 300px;
            float: left;
            background-color: #FFF;
            border-radius: 10px;
        }
        .agree_login_div{
            overflow: hidden;
        }
        .agree_div{
            overflow: hidden;
            float: left;
            width: 190px;
        }
        .agree_left_div{
            overflow: hidden;  
            float: left;
            width: 190px;
            border-bottom: 1px #CCC dotted;
            margin-left: 20px; 
            height: 60px;
        }
        .agree_span{
            display: inline-block;
            width: 80px;
            height: 50px;   
            overflow: hidden;   
            margin-top: 18px;    
        }
        .agree_img{
            width: 28px;
            height: 28px;
            background:url("http://www.btmblog.com/image/home/icons.png");
            background-size:84px 84px;
            background-repeat: no-repeat;
            background-position: -28px -28px;
            float: left;
        }
        .agree_num{
            height: 25px;
            line-height: 25px;
            font-weight: normal;
            font-size: 18px;
            color: #36353b;
            float: left;
            margin-top: 5px;
        }
        .agree_num.hadAgree{
            color: #ec4b38;
        }
        .agree_img.enable{
            cursor: pointer;
        }
        .agree_img.hadAgree{
            background-position: -28px -56px;
        }
        .disagree_span{
            display: inline-block;
            width: 80px;
            height: 50px; 
            overflow: hidden; 
            margin-top: 18px;           
        }
        .disagree_img{
            width: 28px;
            height: 28px;
            background:url("http://www.btmblog.com/image/home/icons.png");
            background-size:84px 84px;
            background-repeat: no-repeat;
            background-position: -56px -28px;
            float: left;
        }
        .disagree_num{
            height: 25px;
            line-height: 25px;
            font-weight: normal;
            font-size: 18px;
            color: #36353b;
            float: left;
            margin-top: 5px;
        }
        .disagree_num.hadDisagree{
            color: #ec4b38;
        }
        .disagree_img.enable{
            cursor: pointer;
        }
        .disagree_img.hadDisagree{
            background-position: -56px -56px;
        }

        .login_btn{
            display: inline-block;
            width: 50px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            background-color: #f6ce5b;
            font-weight: bold;
            font-size: 14px;
            color: #FFF;
            border-radius: 25px;
            cursor: pointer;
            float: right;
            margin-right: 30px;
            margin-top: 10px;
        }
        .user_info_area_btn{
            display: inline-block;
            width: 50px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            background-color: #f6ce5b;
            font-weight: bold;
            font-size: 14px;
            color: #FFF;
            border-radius: 25px;
            border: solid #ccc 1px;
            cursor: pointer;
            float: right;
            margin-top: 10px;
            background-size: 50px 50px;
        }
        .user_info_div{
            margin-left: 30px;
        }
        .comment_big_div{
            margin-left: 15px;
            margin-right: 15px;
            margin-top: 10px;
            border: solid #ccc 1px;
            overflow: hidden;
            border-radius: 5px;
        }
        .comment_btn{
            width: 80px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            color: #FFF;
            background-color: #49c6e1;
            margin-top: 3px;
            margin-right: 3px;
            margin-bottom: 3px;
            border-radius: 5px;
            float: right;
            cursor: pointer;
        }
        .user_email{
            width: 165px;
            height: 25px;
            margin-left: 3px;
            margin-top: 3px;
            padding-left: 5px;
        }
        /*右边栏样式结束*/
        .user_info_open .layui-layer-content{            
            background: #fcf6ee;
        }

        /*评论样式开始*/
        .article_comment{
            margin-left: 15px;
            margin-right: 15px;
            margin-top: 15px;
            border-top: solid #ccc 1px;
        }
        .comment_user_info_content{
            overflow: hidden;            
        }
        .comment_user_info{
            width: 60px;
            overflow: hidden;
            float: left;
        }
        .comment_user_head{
            display: inline-block;
            width: 50px;
            height: 50px;
            border-radius: 25px;
            border: solid #ccc 1px;
            float: left;
            margin-top: 10px;
            background-size: 50px 50px;
        }
        .commeny_name_content{
            width: 215px;
            float: left;
            margin-top: 15px;
        }
        .comment_user_name_agree{
            display: inline-block;
            float: left;
            font-size: 12px;
        }
        .comment_user_name{
            width: 55px;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .comment_content{
            width: 195px;
            float: left;
            margin-left: 10px;
            margin-top: 10px;
            padding-top: 5px;
            padding-bottom: 5px;
            font-size: 12px;
        }
        .comment_agree,.comment_disagree{
            font-size: 10px;
            color: #666666;
        }
        .comment_agree_img{
            width: 16px;
            height: 16px;
            background-image: url("http://www.btmblog.com/image/home/icons.png");
            background-size: 48px 48px;
            background-position: -16px -16px;
            margin-left: 10px;
        }
        .comment_agree_img.enable{
            cursor: pointer;
        }
        .comment_agree_img.hadAgree{
            background-position: -16px -32px;
        }
        .comment_disagree_img{
            width: 16px;
            height: 16px;
            background-image: url("http://www.btmblog.com/image/home/icons.png");
            background-size: 48px 48px;
            background-position: -32px -16px;
        }
        .comment_disagree_img.enable{
            cursor: pointer;
        }
        .comment_disagree_img.hadDisagree{
            background-position: -32px -32px;
        }
        .comment_agree_num,.comment_disagree_num{
            font-size: 10px;
            color: #666666;
            display: inline-block;
            width: 24px;
        }
        .comment_time_div{
            /*margin-left: 90px;*/
            margin-right: 15px;
            margin-top: 30px;
            overflow: hidden;
        }
        .comment_time{
            display: inline-block;
            font-size: 10px;
            color: #666666;
        }
        .comment_time_div .reply_btn{
            margin-left: 5px;
            font-size: 12px;
            color: #2698d7;
            cursor: pointer;
        }
        /*评论样式结束*/

        /*分页样式开始*/
        .page{
            width: 250px;
            margin: 0px auto;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .page ul{
            text-align: center;
        }
        .page ul li{
            list-style: none;
            text-decoration: none;
            display: inline-block;         
            border: solid #ccc 1px;
            text-align: center;
            width: 20px;
            height: 20px;
            line-height: 20px;
            font-size: 12px;
        }

        .page ul li a{
            display: inline-block;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-decoration: none;
            color: #666666;
        }
        .active{
            background: #CCC;
            color: #FFF;
        }
        /*分页样式结束*/

        /*回复样式开始*/
        .reply_user_info_content{
            overflow: hidden;
        }
        .comment_replys{
            margin-left: 65px;
            margin-right: 15px;
        }
        .comment_reply{
            margin-top: 10px;
            border-top: solid 1px #ccc;
        }
        .reply_user_info{
            width: 45px;
            overflow: hidden;
            float: left;
        }
        .reply_user_head{
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 20px;
            border: solid #ccc 1px;
            float: left;
            margin-top: 10px;
            background-size: 40px 40px;
        }
        .reply_user_name_div{
            display: inline-block;
            float: left;
            font-size: 10px;
        }
        .reply_user_name{
            width: 44px;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #666666;
        }
        .reply_for_user_name{
            width: 135px;
            float: left;
            margin-left: 10px;
            margin-top: 10px;
            padding-bottom: 5px;
            font-size: 10px;
            color: #666666;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .reply_content{
            width: 135px;
            float: left;
            margin-left: 10px;
            padding-bottom: 5px;
            font-size: 10px;
        }
        .reply_time_div{
            /*margin-left: 90px;*/
            margin-right: 15px;
            margin-top: 30px;
            overflow: hidden;
        }
        .reply_time{
            display: inline-block;
            font-size: 10px;
            color: #666666;
        }
        .reply_time_div .reply_btn{
            margin-left: 5px;
            font-size: 12px;
            color: #2698d7;
            cursor: pointer;
        }
        .reply_time_agree .reply_btn{
            margin-left: 5px;
            font-size: 12px;
            color: #2698d7;
            cursor: pointer;
        }
        /*回复样式结束*/

        /*回复框样式开始*/
        .reply_show_area{
            margin-top: 20px;
            margin-left: 30px;
            margin-right: 16px;
            border: solid #ccc 1px;
            border-radius: 5px;
        }
        .reply_user_email{
            width: 130px;
            height: 16px;
            padding-left: 10px;
            padding-right: 10px;
            margin-left: 5px;
            font-size: 12px;
            margin-bottom: 5px;
        }
        .reply_comment_btn{
            display: inline-block;
            width: 45px;
            height: 20px;
            line-height: 20px;
            border-radius: 5px;
            color: #FFF;
            text-align: center;
            font-size: 13px;
            margin-top: 5px;
            margin-left: 10px;
            background-color: #49c6e1;
            cursor: pointer;
        }
        .reply_reply_btn{
            display: inline-block;
            width: 45px;
            height: 20px;
            line-height: 20px;
            border-radius: 5px;
            color: #FFF;
            text-align: center;
            font-size: 13px;
            margin-top: 5px;
            margin-left: 10px;
            background-color: #49c6e1;
            cursor: pointer;
        }
        /*回复框样式结束*/

        /*没有评论时样式开始*/
        .no_comments{
            margin-left: 15px;
            margin-right: 15px;
            margin-top: 15px;
            border-top: solid #ccc 1px;
            height: 140px;
            line-height: 140px;
            font-size: 16px;
            color: #666666;
            text-align: center;
        }
        /*没有评论时样式结束*/
	</style>
                    
            <script type="text/javascript" src="http://www.btmblog.com/js/jquery-1.8.3.min.js"></script>
        <script type="text/javascript" src="http://www.btmblog.com/js/common.js"></script>
        <script type="text/javascript" src="http://www.btmblog.com/js/md5.js"></script>
        <script type="text/javascript" src="http://www.btmblog.com/plugin/layer-v3.1.0/layer/layer.js"></script>
        <script type="text/javascript" src="http://www.btmblog.com/plugin/handlebars-v3.0.3.min.js"></script>
            <script type="text/javascript" src="http://www.btmblog.com/plugin/layer-v3.1.0/layer/layer.js"></script>
    <script type="text/javascript" src="http://www.btmblog.com/plugin/handlebars-v3.0.3.min.js"></script>   
    <script type="text/javascript" src="http://www.btmblog.com/plugin/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" src="http://www.btmblog.com/plugin/ueditor/ueditor.all.js"></script>
    <script type="text/javascript" src="http://www.btmblog.com/plugin/ueditor/ueditor.parse.js"></script>
        </head>
    <body>
        
        <div class='common_top'>
            
            <!-- 公共导航栏 -->
	<div class='common_nav'>
		<a href="/"><div class='home_img dib'></div></a>
		<div class='common_nav_box dib'>
			<a href="/" class='dib'><span class='dib common_nav_list'>首页</span><div class='small_nav hide'>home</div></a>
			<a href="/Article/articleList/1" class='dib'><span class='dib common_nav_list'>编程语言</span><div class='small_nav hide'>language</div></a>
			<a href="/Article/articleList/3" class='dib'><span class='dib common_nav_list'>web前端</span><div class='small_nav hide'>vision</div></a>
			<a href="/Article/articleList/2" class='dib'><span class='dib common_nav_list'>数据处理</span><div class='small_nav hide'>data</div></a>
			<a href="/Article/articleList/14" class='dib'><span class='dib common_nav_list'>其它学习</span><div class='small_nav hide'>other</div></a>
			<a href="/Article/articleList/18" class='dib'><span class='dib common_nav_list'>随笔</span><div class='small_nav hide'>dream</div></a>
			<a href="/Message" class='dib'><span class='dib common_nav_list'>留言</span><div class='small_nav hide'>message</div></a>
		</div>
	</div>        </div>
        <div class='common_body'>
            <div class='background'>
            
                <div class='home_main_content' article_id="12">
        <!-- 左边显示文章内容，右边显示评论和点赞等操作 -->
        <div class='article_left_box'>
            <div class='article_show_div'>
                <div class='article_title'>
                    写给thinkphp开发者的laravel系列教程(七)视图
                </div>
                <div class='author_time_tags'>
                    <!-- 作者 -->
                    <span class='author_span dib' title='作者'> 
                        <span class='dib author_img'></span><span class='author_name'>半透明</span>
                    </span>
                    <!-- 时间 -->
                    <span class='time_span dib' title='发布时间'>
                        <span class='dib time_img'></span><span class='article_time'>2017-11-12 10:57:15</span>
                    </span>
                    <!-- 标签 -->
                    <span class='dib article_tag'>
                        <span class='dib article_tag_img'></span>
                         
                                                            <a href="/Article/articleList/1" class='tag_a'><div class='tag color_1 
                                ' data_id='1'>编程语言</div></a>
                                                            <a href="/Article/articleList/11" class='tag_a'><div class='tag color_3 
                                ' data_id='11'>php</div></a>
                                                            <a href="/Article/articleList/15" class='tag_a'><div class='tag color_2 
                                ' data_id='15'>laravel</div></a>
                                                            <a href="/Article/articleList/16" class='tag_a'><div class='tag color_1 
                                ' data_id='16'>thinkphp</div></a>
                                                                             
                         
                    </span>
                </div>
                <div class='article_content'>
                    <p>相对于 MC；<br/>laravel的视图V可能是最容易上手的；<br/>但是如果想用好；<br/>那也是我们 phper 最难掌握的部分；<br/>因为它涉及到了领域叫前端；<br/>laravel 和 node.js 有着非常紧密的结合；<br/>这也正是 laravel 强大的原因之一；<br/>它不仅仅是一个 php 框架；<br/>它更是一个全栈框架；<br/>不熟悉 node.js 的童鞋很难发挥出它巨大的威力；<br/>不过没关系；<br/>它的基础功能就够我们用了；<br/>先入门；<br/>高深的部分咱边用边学；</p><p>thinkphp 的视图模板文件就是以<code>.html</code>为后缀的；<br/>写 html 的童鞋会很熟悉；<br/>而 laravel 全框架则一个 html 文件都木有；<br/>laravel 的前端模板用的是 blade ；<br/>所有的模板文件都是以<code>.blade.php</code>为后缀；<br/>稍微吐槽下；<br/>作为一个喜欢精简的处女座；<br/>有目录作为限制；<br/>我是不喜欢这种啰嗦一长串的方式；<br/>这给我有种 thinkphp 控制器的 <code>.class.php</code> 后缀的既视感；<br/>不过这都不是问题；<br/>就当 <code>.blade.php</code> 是 <code>.html</code> 就行了；<br/>该怎么写 html 还怎么写；</p><p>先来说在 html 写 php 的控制结构；<br/>thinkphp 中把 php 的 foreach 、 if 等都定义成 html 标签的形式； <br/>我当年还写文章讲解怎么自定义标签来着；<br/><a href="https://baijunyao.com/article/21" target="_blank">thinkphp 自定义模板标签 (一)</a>； &nbsp; <br/>拿循环数据的 foreach 举个栗子；<br/>thinkphp 中有 foreach 和 volist ；<br/>写出来是下面这个样子的；</p><pre class="line-numbers language-html code-toolbar">&lt;p&gt;下面是&nbsp;foreach&nbsp;标签&lt;/p&gt;&lt;foreach&nbsp;name=&quot;list&quot;&nbsp;item=&quot;vo&quot;&nbsp;key=&quot;k&quot;&nbsp;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;{$k}|{$vo}&lt;/foreach&gt;&lt;p&gt;下面是&nbsp;volist&nbsp;标签&lt;/p&gt;&lt;volist&nbsp;name=&quot;list&quot;&nbsp;id=&quot;vo&quot;&nbsp;offset=&quot;5&quot;&nbsp;length=&#39;10&#39;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;{$vo.name}&lt;/volist&gt;</pre><pre class="line-numbers language-html code-toolbar">HTML</pre><p>吐槽完了 laravel 咱来吐槽下 thinkphp 呗；<br/>首先 thinkphp 这种标签的形式给大家增加了学习成本；<br/>循环个数据都有两个标签；<br/>这就算了标签中的属性名还都不一样；<br/>反正我是经常代码敲到要循环数据的时候；<br/>我得先想下我是要用 foreach 还是 volist 呢？<br/>然后再想下定义 value 的属性是 item 还是 id 呢？<br/>最后还要考虑下这个 offset 和 length 的用法；<br/>还有就是这些标签和 html 混搭不是很好分辨；<br/>laravel 在这方面做的就比较优雅了；<br/>只是加个@符号就行了；<br/>代码就是下面这个样子了；</p><pre class="line-numbers language-html code-toolbar">&lt;p&gt;下面是&nbsp;foreach&nbsp;标签&lt;/p&gt;@foreach($list&nbsp;as&nbsp;$k&nbsp;=&gt;&nbsp;$v)
&nbsp;&nbsp;&nbsp;&nbsp;{{&nbsp;$v[&#39;name&#39;]&nbsp;}}
@endforeach</pre><pre class="line-numbers language-html code-toolbar">HTML</pre><p>而控制循环的起止个数可以用<code>$loop</code>；<br/>通过上面代码；<br/>我们也可以很容易就发现了；<br/>thinkphp 在 html 中输出变量使用的是一个花括号<code>{}</code>；<br/>laravel 使用的是两个花括号<code>{{}}</code>;</p><p>接着来讲下模板继承；<br/>一般网站开发的时候都是有大面积的公共部分；<br/>比如说我的博客；<br/>顶部的导航菜单、右侧、底部都是通用的；<br/>只有左侧是变化的；<br/>模板继承功能就是处理这种场景的；<br/>thinkphp 使用的是 <code>block</code>;<br/>laravel 这次则反过来有两种情况；<br/>在父级模板中；<br/>只有简单纯文字的时候就用 <code>yield</code> 比如说网站 title ；<br/>如果是大段代码的话就用 <code>section</code>；<br/>点到为止；详细的看文档；</p><p>有了模板文件；<br/>就是要分配数据了；<br/>父级模板中的那些公共部分的数据大多也是通用的；<br/>还是比如说顶部的导航菜单、右侧、底部的数据也都是通用的；<br/>如何共用这部分数据呢？<br/>thinkphp 中我们是通过使用控制器继承的方式分配数据；<br/>laravel 可以使用 <code>View::composer</code> ;<br/>可以先看下官方文档 <a href="https://laravelacademy.org/post/6758.html" target="_blank">HTTP 层 —— 视图</a> &nbsp;;<br/>主要是通配符；<br/>比如说我们要给前端 home 模块分配分类 category 数据；<br/>在 /app/Providers/AppServiceProvider.php 文件的 boot 中;</p><pre class="line-numbers language-php code-toolbar">//&nbsp;分配前台通用的&nbsp;category&nbsp;数据view()-&gt;composer(&#39;home/*&#39;,&nbsp;function&nbsp;($view)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;获取配置项
&nbsp;&nbsp;&nbsp;&nbsp;$category&nbsp;=&nbsp;Category::all();
&nbsp;&nbsp;&nbsp;&nbsp;$assign&nbsp;=&nbsp;[
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;category&#39;&nbsp;=&gt;&nbsp;$category
&nbsp;&nbsp;&nbsp;&nbsp;];
&nbsp;&nbsp;&nbsp;&nbsp;$view-&gt;with($assign);});</pre><pre class="line-numbers language-php code-toolbar">PHP</pre><p>这里需要提醒下；<br/>第一个参数的 <code>home/*</code> ；<br/>指的是 <code>resources/views/home</code> 目录；<br/>此目录下的所有模板文件都将分配 <code>category</code> 数据；</p><p>控制器中分配数据和载入模板文件前面文章讲了点；<br/>thinkphp中的分配数据是使用 assign；<br/>以文章首页的方法为例；</p><pre class="line-numbers language-php code-toolbar">public&nbsp;function&nbsp;index(){
&nbsp;&nbsp;&nbsp;&nbsp;$assign&nbsp;=&nbsp;[
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;title&#39;&nbsp;=&gt;&nbsp;&#39;白俊遥文章的标题&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;content&#39;&nbsp;=&gt;&nbsp;&#39;白俊遥文章的内容&#39;
&nbsp;&nbsp;&nbsp;&nbsp;]
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;assign($assign);
&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;display(&#39;Home/Index/index&#39;);}</pre><pre class="line-numbers language-php code-toolbar">PHP</pre><p>如果当前的方法要引入的html页面跟控制器目录结构一致；<br/>那 display 是可以不传参数的；<br/>Home 模块下的 IndexController 的 index 方法中；<br/>display 不传参数跟传<code>&#39;Home/Index/index&#39;</code>是一样的；</p><pre class="line-numbers language-php code-toolbar">$this-&gt;display()$this-&gt;display(&#39;Home/Index/index&#39;);</pre><pre class="line-numbers language-php code-toolbar">PHP</pre><p>到了 laravel 中就是这个样子的了；</p><pre class="line-numbers language-php code-toolbar">public&nbsp;function&nbsp;index(){
&nbsp;&nbsp;&nbsp;&nbsp;$assign&nbsp;=&nbsp;[
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;title&#39;&nbsp;=&gt;&nbsp;&#39;白俊遥文章的标题&#39;,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;content&#39;&nbsp;=&gt;&nbsp;&#39;白俊遥文章的内容&#39;
&nbsp;&nbsp;&nbsp;&nbsp;]
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;view(&#39;home.index.index&#39;,&nbsp;$assign);}</pre><pre class="line-numbers language-php code-toolbar">PHP</pre><p>laravel 用 view 函数可以实现分配和引入页面两个功能；<br/>第一个参数是要引入的页面相对于<code>resources/view</code>的路径；<br/>如果习惯 thinkphp 的用斜线分割的方式；<br/>laravel 也是支持的；下面这两种写法是相等的；</p><pre class="line-numbers language-php code-toolbar">return&nbsp;view(&#39;home.index.index&#39;,&nbsp;$assign);return&nbsp;view(&#39;home/index/index&#39;,&nbsp;$assign);</pre><pre class="line-numbers language-php code-toolbar">PHP</pre><p>这里推荐使用点 <code>.</code> 分割；<br/>因为 phpstorm 默认是可以识别laravel项目的.分割的；<br/>在控制器中按着 ctrl 点 <code>&#39;home.index.index&#39;</code> 是可以直接打开该文件的；<br/>相当之方便；<br/>如果完全复制之前文章的话；<br/>那不是显得太懒了；<br/>这里讲个小技巧；<br/>可以通过 <code>compact</code> 函数组合 <code>$assign</code> 数组；<br/>再举个栗子吧；</p><pre class="line-numbers language-php code-toolbar">public&nbsp;function&nbsp;index(){
&nbsp;&nbsp;&nbsp;&nbsp;$article&nbsp;=&nbsp;Article::all();
&nbsp;&nbsp;&nbsp;&nbsp;$category&nbsp;=&nbsp;Category::all();
&nbsp;&nbsp;&nbsp;&nbsp;$tag&nbsp;=&nbsp;Tag::all();
&nbsp;&nbsp;&nbsp;&nbsp;$assign&nbsp;=&nbsp;[
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;article&#39;&nbsp;=&gt;&nbsp;$article,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;category&#39;&nbsp;=&gt;&nbsp;$category,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tag&#39;&nbsp;=&gt;&nbsp;$tag
&nbsp;&nbsp;&nbsp;&nbsp;];
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;view(&#39;home.index.index&#39;,&nbsp;$assign);}</pre><pre class="line-numbers language-php code-toolbar">PHP</pre><p>上面代码等同于下面代码；</p><pre class="line-numbers language-php code-toolbar">public&nbsp;function&nbsp;index(){
&nbsp;&nbsp;&nbsp;&nbsp;$article&nbsp;=&nbsp;Article::all();
&nbsp;&nbsp;&nbsp;&nbsp;$category&nbsp;=&nbsp;Category::all();
&nbsp;&nbsp;&nbsp;&nbsp;$tag&nbsp;=&nbsp;Tag::all();
&nbsp;&nbsp;&nbsp;&nbsp;$assign&nbsp;=&nbsp;compact(&#39;article&#39;,&nbsp;&#39;category&#39;,&nbsp;&#39;tag&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;view(&#39;home.index.index&#39;,&nbsp;$assign);}</pre><pre class="line-numbers language-php code-toolbar">PHP</pre><p>好了；<br/>去掉相同的代码；<br/>不用我说童鞋们应该也知道 <code>compact</code> 的作用了；<br/>实在不明白；<br/>查下php手册吧；</p><p><img src="/article_images/20171112/1510484195408398.jpg" title="1510484195408398.jpg" alt="3.jpg"/><br/></p><p>本文转载自<a href="http://baijunyao.com">白俊遥博客</a>https://baijunyao.com</p>
                </div>
            </div>
        </div>

        <div class='article_right_box'>
            <div class='agree_login_div'>
                <div class='agree_div'>
                    <div class='agree_left_div'>
                       
                    </div>
                </div>
                <div class='user_info_div dib'>
                    
                </div>
            </div>
            <div class='comment_big_div'>
                <!-- 评论输入框 -->
                <div class='input_comment_div'>
                    <script id="editor" type="text/plain"> </script>
                </div>
                <div>
                    <span><input type="text" class='user_email' placeholder="接收回复的email地址" /></span>
                    <span class='comment_btn dib'>评论</span>
                </div>
            </div>
            <div class='article_comments_replys'>
                
            </div>
            <div class='page'></div>
        </div>
    </div>
                </div>
        </div>
        <div class='common_bottom'>
            <div class='common_bottom_content'>
	<a href="http://www.miitbeian.gov.cn" target="_blank">ICP：皖ICP备18001809号</a>
</div>        </div>
        <!-- 公共登录弹窗 -->
        <div class='commen_login_div hide'>
            <!-- 账号密码登录-暂时先用，等有了微信登陆之后，去掉这个功能，或者改为微信的账号密码登录 -->
            <div class='login_by_input'>
                <div class="login_user_name_div">
                    <span >用户名：</span>
                    <input type="text" class='user_name' />
                </div>
                <div class="login_user_password_div">
                    <span>密&nbsp;&nbsp;&nbsp;码：</span>
                    <input type="password" class='password' />
                </div>
                <div>
                    <span class='common_login_btn'>登录</span>
                </div>
                <div class='no_account_regist_div'>
                    <span>没有账号？<a href='/regist' target="_blank">注册</a></span>
                </div>
            </div>
            <!-- 微信扫码登录 -->
            <div class='login_by_wx hide'>
                <!-- 放二维码的div -->
                <div>
                    
                </div>
            </div>

            <div class='change_login_method'>
                <span class='change_method_wx'>微信登录</span>
                <span class='change_method_wb'>微博登录</span>
            </div>
        </div>

        <!-- 公共个人信息展示窗 -->
        <div class='user_info_box hide'>
            
        </div>
    </body>
    
        <script  id="user_info_box_tmp" type="text/x-handlebars-template">
            <div class='user_info_box_id' user_id="{{uid}}">
                <!-- 头像 -->
                <span class='user_head'
                    {{#eq head 0}}
                        style="background-image: url('http://www.btmblog.com/image/home/default_head.jpg');"
                    {{else}}
                        style="background-image: url('http://www.btmblog.com/image/home/headimg.jpg');"
                    {{/eq}} 
                ></span>
                  
                <div class='user_name_history_reply'>
                    <!-- 昵称 -->
                    <span class='user_nick_name' title="{{nick_name}}">{{nick_name}}</span> 
                    <!-- 浏览历史 -->
                    <a class='view_history_a' href='/User/viewHistory' target="_blank">阅读历史：12345</a>
                    <!-- 查看回复 -->
                    <a class='my_reply_a' href="/User/replyRecord" target="_blank">收到回复：123</a>
                </div>
                            
            </div>
            <div>
                <a href="/User/profile" class='user_profile' target="_blank">个人中心</a>
                <span class='login_out_btn'>注销</span>
            </div>
        </script>
        
        
    <script  id="article_info" type="text/x-handlebars-template">
         <!-- 作者 -->
        <span class='author_span dib' title='作者'> 
            <span class='dib author_img'></span><span class='author_name'>{{author}}</span>
        </span>
        <!-- 时间 -->
        <span class='time_span dib' title='发布时间'>
            <span class='dib time_img'></span><span class='article_time'>{{publish_time}}</span>
        </span>
        <!-- 标签 -->
        <span class='dib article_tag'>
            <span class='dib article_tag_img'></span>
            {{#if tags}}
                {{#each tags}}
                <a href="" class='tag_a'><div class='tag color_{{color}} {{#eq status 0}}ban{{/eq}}' data_id='{{id}}'>{{name}}</div></a>
                {{/each}}                                                   
            {{else}}                   
                <span class='no_tags'>暂无标签</span>
            {{/if}}
        </span>
    </script>

    <script  id="article_info_right" type="text/x-handlebars-template">
        <div class='agree_left_div'>
            <!-- 点赞 -->
            <span class='dib agree_span' title='赞'><span class='dib agree_img {{#eq agree_type 0}}enable{{/eq}} {{#eq agree_type 1}}hadAgree{{/eq}}' article_id='{{id}}'></span><span class='agree_num {{#eq agree_type 1}}hadAgree{{/eq}}' article_id='{{id}}' agree_num='{{agree_num}}'>{{agree_num}}</span></span>
            <!-- 点踩 -->
            <span class='dib disagree_span' title='踩'><span class='dib disagree_img {{#eq agree_type 0}}enable{{/eq}} {{#eq agree_type 2}}hadDisagree{{/eq}}' article_id='{{id}}'></span><span class='disagree_num {{#eq agree_type 2}}hadDisagree{{/eq}}' article_id='{{id}}' disagree_num='{{disagree_num}}'>{{disagree_num}}</span></span>
        </div>
    </script>
    <script  id="article_comments" type="text/x-handlebars-template">
        {{#each comments}}
        <div class='article_comment' comment_id='{{id}}'>
            <div class='comment_user_info_content'>
                <div class='comment_user_info'>
                    <span class='comment_user_head' 
                        {{#eq user_head 0}}
                            style="background-image: url('http://www.btmblog.com/image/home/default_head.jpg');"
                        {{else}}
                            style="background-image: url('http://www.btmblog.com/image/home/head_img.jpg');"
                        {{/eq}}
                    ></span>

                    <div class='comment_user_name_agree'>
                        <span class='comment_user_name dib' title="{{user_name}}">{{user_name}}</span>
                    </div>
                </div>
                <div class='comment_content'>{{{content}}}</div> 
                                  
            </div>                   
            <div class='comment_time_div'>
                <div class='oprs'>  
                    <span class='comment_time'>{{publish_time}}</span>                 
                    <!-- 点赞 -->
                    <span class='dib comment_agree_span' title='赞'><span class='dib comment_agree_img {{#eq agree_type 0}}enable{{/eq}} {{#eq agree_type 1}}hadAgree{{/eq}}' comment_id='{{id}}'></span><span class='comment_agree_num {{#eq agree_type 1}}hadAgree{{/eq}}' comment_id='{{id}}' agree_num='{{agree_num}}'>{{agree_num}}</span></span>
                    <!-- 点踩 -->
                    <span class='dib comment_disagree_span' title='踩'><span class='dib comment_disagree_img {{#eq agree_type 0}}enable{{/eq}} {{#eq agree_type 2}}hadDisagree{{/eq}}' comment_id='{{id}}'></span><span class='comment_disagree_num {{#eq agree_type 2}}hadDisagree{{/eq}}' comment_id='{{id}}' disagree_num='{{disagree_num}}'>{{disagree_num}}</span></span>
                    <span class='reply_btn' comment_id='{{id}}' user_id='{{user_id}}' user_name='{{user_name}}'>回复</span>
                </div>              
                
                <!-- <span>删除</span> -->
            </div>

            <div class='comment_replys'>
                {{#each replys}}
                    <div class='comment_reply'>
                        <div class='reply_user_info_content'>
                            <div class='reply_user_info'>
                                <span class='reply_user_head'
                                    {{#eq user_head 0}}
                                        style="background-image: url('http://www.btmblog.com/image/home/default_head.jpg');"
                                    {{else}}
                                        style="background-image: url('http://www.btmblog.com/image/home/head_img.jpg');"
                                    {{/eq}}
                                >
                                </span>
                                <div class='reply_user_name_div'>
                                    <span class='reply_user_name' title="{{user_name}}">{{user_name}}</span>
                                </div>                           
                            </div>
                            <div>
                                <div class='reply_for_user_name' title='{{reply_for_user_name}}'>回复：{{reply_for_user_name}}</div>
                                <div class='reply_content'>{{{content}}}</div>
                            </div>
                        </div>
                        <div class='reply_time_agree'>
                            <span class='reply_time'>{{publish_time}}</span>
                            <span class='reply_btn reply_for_reply' reply_id='{{id}}' comment_id='{{comment_id}}' user_id='{{user_id}}' user_name='{{user_name}}'>回复</span>
                        </div>
                    </div>
                {{/each}}
            </div> 
        </div>
                   
        {{/each}}
    </script>
    <script  id="no_comments" type="text/x-handlebars-template">
        <div class='no_comments'>还没有人评论哦~快抢沙发！</div>
    </script>

    <script  id="user_info" type="text/x-handlebars-template">
        <!-- 登录 -->
        {{#eq uid 0}}
            <span class='login_btn'>登录</span>
        {{else}}
            <span class='user_info_area_btn'
                {{#eq head 0}}
                    style="background-image: url('http://www.btmblog.com/image/home/default_head.jpg');"
                {{else}}
                    style="background-image: url('http://www.btmblog.com/image/home/headimg.jpg');"
                {{/eq}} 
            >
            </span>
        {{/eq}}
    </script>
    
    
    <script type="text/javascript">
        $(function(){
            //解析文章内容
            uParse('.article_content', {rootPath : "http://www.btmblog.com/plugin/ueditor"});

            var id = $('.home_main_content').attr('article_id');

            // 获取用户的个人信息
            $.post('/User/getUserInfo', null, function(data){
                $('.user_info_div').html($('#user_info').template(data.info));
                $('.user_info_box').html($('#user_info_box_tmp').template(data.info));
            });
            

            // 获取点赞数量
            $.post('/Article/getArticleDetail', {id : id}, function(data){
                if(data.status){
                    data = data.info;
                    $('.agree_div').html($('#article_info_right').template(data));
                    // $('.agree_login_div .agree_num').attr('agree_num', data.agree_num);
                    // $('.agree_login_div .agree_num').html(data.agree_num);
                    // $('.agree_login_div .disagree_num ').attr('disagree_num ', data.disagree_num );
                    // $('.agree_login_div .disagree_num ').html(data.disagree_num);
                }else{
                    layer.alert('获取点赞数据失败！');
                }
                
            })          

            //获取文章的点赞、点踩、评论、回复等信息
            $.post('/Article/getArticleRelateInfo', {id : id}, function(data){
                if(data.status){
                    //设置评论和回复
                    $('.article_comments_replys').html($('#article_comments').template(data.info));

                    //设置评论分页
                    $('.page').html(data.info.pages);
                }else{
                    //没有评论
                    $('.article_comments_replys').html($('#no_comments').template());                        
                }
                
            })

            //实例化编辑器
            var ue = UE.getEditor( 'editor',{
                autoHeightEnabled: false,
                initialFrameWidth: 266,
                initialFrameHeight:120,
                elementPathEnabled:false,//删除元素路径
                wordCount: false,//删除字数统计
                pasteplain: true,//纯文本粘贴
                autoFloatEnabled: false,//工具栏不固定
                initialContent: '',
                autoClearinitialContent: true,
                toolbars: [
                    ['emotion'] //,'fullscreen'
                ]
            });

            ue.ready(function () {
                // 删除 路径一行
                $(".edui-editor-bottomContainer").remove();
            });  

            $('body').onEvent({
                'click' : {
                    '.comment_btn' : function(){
                        //获取评论的内容
                        var comment = ue.getContent();
                        var text = ue.getContentTxt();
                        if(parseInt(text.trim().length) < 5){
                            layer.msg('请至少输入5个字！');
                            return false;
                        }
                        //获取邮箱地址
                        var email = $('.user_email').val();
                        //如果有邮箱地址，则验证邮箱地址正则
                        if(email != ''){
                            //仅支持qq邮箱、126邮箱、163邮箱、新浪邮箱和gmail
                            var pattern = /^([a-zA-Z0-9])+@(qq\.com)|(163\.com)|(126\.com)|(sina\.com)|(sina\.cn)|(gmail\.com)$/;
                            // var patt = new RegExp(pattern);
                            if(!pattern.exec(email)){
                                layer.alert('邮箱格式不正确，目前仅支持qq邮箱、163邮箱、126邮箱、gmail和新浪邮箱');
                                return false;
                            }
                        }
                        var article_id = $('.home_main_content').attr('article_id');

                        var params = {
                            article_id : article_id,
                            comment : comment,
                            email : email
                        }
                        //提交评论
                        $.post('/Article/comment', params, function(data){
                            if(data.status){
                                //重置评论输入框的内容
                                ue.setContent('');                               
                                layer.msg('评论成功！');
                                //刷新页面
                                window.location.reload();
                            }else{
                                layer.msg(data.info);
                            }
                        })
                    },                    
                    '.user_info_area_btn' : function(){
                        var user_id = $('.user_info_box_id').attr('user_id');                       
                        if(user_id != ''){
                            //展示用户个人信息窗口
                            layer.open({
                                type: 1,
                                title: false,
                                maxmin: false, //弹出层是否可缩放
                                shadeClose: false, //点击遮罩关闭层
                                closeBtn: 2,
                                shade: 0,
                                skin: 'user_info_open',
                                area : ['250px' , '150px'],
                                offset: ['60px', '1000px'],
                                content: $('.user_info_box')
                            })
                        }                       
                    },
                    '.page ul li a' : function(e){
                        //处理分页的标签点击事件，阻止a标签，然后用ajax获取数据
                        e.preventDefault();
                        //检测其它评论下是否有回复框，如果有，则关掉其它回复框
                        if($('.article_comment .reply_show_area').length > 0){
                            //销毁编辑器
                            UE.getEditor('reply_editor').destroy();
                            $('.article_comment .reply_show_area').remove();
                        }

                        var id = $('.home_main_content').attr('article_id');
                        var url = $(this).attr('href');
                        url = url + '&id='+id;
                        var params = getParams(url);                       
                        
                        //获取其它页的文章
                        $.post('/Article/getArticleRelateInfo', params, function(data){
                            if(data.status){
                                //设置评论和回复
                                $('.article_comments_replys').html($('#article_comments').template(data.info));
                                //设置评论分页
                                $('.page').html(data.info.pages);
                            }else{
                                layer.msg('获取数据失败');
                            }                           
                        })
                    },
                    '.reply_btn' : function(){
                        var user_id = $(this).attr('user_id');
                        var comment_id = $(this).attr('comment_id');
                        var user_name = $(this).attr('user_name');

                        //检测当前评论下是否有回复框，如果有，不做任何处理
                        if($(this).closest('.article_comment').find('.reply_show_area').length > 0){
                            //销毁编辑器
                            UE.getEditor('reply_editor').destroy();
                            $('.article_comment .reply_show_area').remove();
                        }

                        //检测其它评论下是否有回复框，如果有，则关掉其它回复框
                        if($('.article_comment .reply_show_area').length > 0){
                            //销毁编辑器
                            UE.getEditor('reply_editor').destroy();
                            $('.article_comment .reply_show_area').remove();
                        }
                        if($(this).hasClass('reply_for_reply')){
                            var str = "<div class='hide reply_show_area'><div class='reply_area'><script id='reply_editor' type='text/plain'><\/script><\/div><div><span><input type='text' class='reply_user_email' placeholder='接收回复的email地址' \/><\/span><span class='reply_reply_btn dib' user_id='"+user_id+"' comment_id='"+comment_id+"'>评论<\/span><\/div><\/div>";
                        }else{
                            var str = "<div class='hide reply_show_area'><div class='reply_area'><script id='reply_editor' type='text/plain'><\/script><\/div><div><span><input type='text' class='reply_user_email' placeholder='接收回复的email地址' \/><\/span><span class='reply_comment_btn dib' user_id='"+user_id+"' comment_id='"+comment_id+"'>评论<\/span><\/div><\/div>";
                        }
                        
                        $(this).closest('.article_comment').append(str);
                        $('.reply_show_area').removeClass('hide');
                        //实例化编辑器
                        reply_ue = UE.getEditor('reply_editor',{
                            autoHeightEnabled: false,
                            initialFrameWidth: 220,
                            initialFrameHeight:80,
                            elementPathEnabled:false,//删除元素路径
                            wordCount: false,//删除字数统计
                            pasteplain: true,//纯文本粘贴
                            autoFloatEnabled: false,//工具栏不固定
                            initialContent: '回复@'+user_name+'：',
                            autoClearinitialContent: true,
                            toolbars: [
                                ['emotion'] //,'fullscreen'
                            ]
                        });
                    },
                    '.reply_comment_btn' :  function(){
                        var reply_content = reply_ue.getContent();
                        var reply_email = $('.reply_user_email').val();
                        var comment_id = $(this).attr('comment_id');
                        var reply_for_uid = $(this).attr('user_id');

                        //获取焦点，让编辑器去掉默认内容
                        reply_ue.focus();
                        var text = reply_ue.getContentTxt();
                        if(parseInt(text.trim().length) < 1){
                            layer.msg('请至少输入一个字！');
                            return false;
                        }
                        //如果有邮箱地址，则验证邮箱地址正则
                        if(reply_email != ''){
                            //仅支持qq邮箱、126邮箱、163邮箱、新浪邮箱和gmail
                            var pattern = /^([a-zA-Z0-9])+@(qq\.com)|(163\.com)|(126\.com)|(sina\.com)|(sina\.cn)|(gmail\.com)$/;
                            // var patt = new RegExp(pattern);
                            if(!pattern.exec(reply_email)){
                                layer.alert('邮箱格式不正确，目前仅支持qq邮箱、163邮箱、126邮箱、gmail和新浪邮箱');
                                return false;
                            }
                        }
                        var params = {
                            reply_content : reply_content,
                            reply_email : reply_email,
                            comment_id : comment_id,
                            reply_for_uid : reply_for_uid
                        };
                        $.post('/Article/replyForComment', params, function(data){
                            if(data.status){
                                data = data.info;
                                //销毁编辑器
                                UE.getEditor('reply_editor').destroy();
                                $('.article_comment .reply_show_area').remove();

                                //在这条评论的最后加上回复的内容
                                var str = "<div class='comment_reply'><div class='reply_user_info_content'><div class='reply_user_info'><span class='reply_user_head' style=\"background-image: url('http://www.btmblog.com/image/"+data.head+".jpg');\"></span><div class='reply_user_name_div'><span class='reply_user_name' title='"+data.user_name+"'>"+data.user_name+"</span></div></div><div><div class='reply_for_user_name' title='"+data.reply_for_user_name+"'>回复："+data.reply_for_user_name+"</div><div class='reply_content'>"+data.content+"</div></div></div><div class='reply_time_agree'><span class='reply_time'>"+data.publish_time+"</span><span class='reply_btn reply_for_reply' reply_id='"+data.id+"' comment_id='"+data.comment_id+"' user_id='"+data.user_id+"' user_name='"+data.user_name+"'>回复</span></div></div>";


                                $('.article_comment[comment_id='+data.comment_id+']').find('.comment_replys').append(str);
                                layer.msg('评论成功！');
                            }else{
                                layer.msg(data.info);
                            }
                        })

                    },
                    '.reply_reply_btn' : function(){
                        var reply_content = reply_ue.getContent();
                        var reply_email = $('.reply_user_email').val();
                        var comment_id = $(this).attr('comment_id');
                        var reply_for_uid = $(this).attr('user_id');
                        //获取焦点，让编辑器去掉默认内容
                        reply_ue.focus();
                        var text = reply_ue.getContentTxt();

                        if(parseInt(text.trim().length) < 1){
                            layer.msg('请至少输入一个字！');
                            return false;
                        }
                        //如果有邮箱地址，则验证邮箱地址正则
                        if(reply_email != ''){
                            //仅支持qq邮箱、126邮箱、163邮箱、新浪邮箱和gmail
                            var pattern = /^([a-zA-Z0-9])+@(qq\.com)|(163\.com)|(126\.com)|(sina\.com)|(sina\.cn)|(gmail\.com)$/;
                            // var patt = new RegExp(pattern);
                            if(!pattern.exec(reply_email)){
                                layer.alert('邮箱格式不正确，目前仅支持qq邮箱、163邮箱、126邮箱、gmail和新浪邮箱');
                                return false;
                            }
                        }
                        var params = {
                            reply_content : reply_content,
                            reply_email : reply_email,
                            comment_id : comment_id,
                            reply_for_uid : reply_for_uid
                        };
                        $.post('/Article/replyForReply', params, function(data){
                            if(data.status){
                                data = data.info;
                                //销毁编辑器
                                UE.getEditor('reply_editor').destroy();
                                $('.article_comment .reply_show_area').remove();
                                
                                //在这条评论的最后加上回复的内容
                                var str = "<div class='comment_reply'><div class='reply_user_info_content'><div class='reply_user_info'><span class='reply_user_head' style=\"background-image: url('http://www.btmblog.com/image/"+data.head+".jpg');\"></span><div class='reply_user_name_div'><span class='reply_user_name' title='"+data.user_name+"'>"+data.user_name+"</span></div></div><div><div class='reply_for_user_name' title='"+data.reply_for_user_name+"'>回复："+data.reply_for_user_name+"</div><div class='reply_content'>"+data.content+"</div></div></div><div class='reply_time_agree'><span class='reply_time'>"+data.publish_time+"</span><span class='reply_btn reply_for_reply' reply_id='"+data.id+"' comment_id='"+data.comment_id+"' user_id='"+data.user_id+"' user_name='"+data.user_name+"'>回复</span></div></div>";


                                $('.article_comment[comment_id='+data.comment_id+']').find('.comment_replys').append(str);
                                layer.msg('评论成功！');
                            }else{
                                layer.msg(data.info);
                            }
                        })
                    },
                    '.agree_img.enable' : function(){
                        var article_id = $(this).attr('article_id');
                        $.post('/Article/addArticleAgree',{article_id : article_id},function(data){
                            if(data.status){
                                //将该点赞按钮和点踩按钮变成不可点击
                                $('.agree_img').removeClass('enable').addClass('hadAgree');
                                $('.disagree_img').removeClass('enable');
                                var agree_num = $('.agree_num').attr('agree_num');
                                agree_num = parseInt(agree_num) + 1;
                                $('.agree_num').html(agree_num).addClass('hadAgree');

                                layer.msg('操作成功！');                                    
                            }else{
                                layer.msg(data.info);
                            }
                        })
                   },
                   '.disagree_img.enable' : function(){
                        var article_id = $(this).attr('article_id');
                        $.post('/Article/addArticleDisagree',{article_id : article_id},function(data){
                            if(data.status){
                                //将该点赞按钮和点踩按钮变成不可点击
                                $('.agree_img').removeClass('enable');
                                $('.disagree_img').removeClass('enable').addClass('hadDisagree');
                                var disagree_num = $('.disagree_num').attr('disagree_num');
                                disagree_num = parseInt(disagree_num) + 1;
                                $('.disagree_num').html(disagree_num).addClass('hadDisagree');

                                layer.msg('操作成功！');                                    
                            }else{
                                layer.msg(data.info);
                            }
                        })
                   },
                   '.comment_agree_img.enable' : function(){
                        var comment_id = $(this).attr('comment_id');
                        $.post('/Article/addCommentAgree',{comment_id : comment_id},function(data){
                            if(data.status){
                                //将该点赞按钮和点踩按钮变成不可点击
                                $('.comment_agree_img[comment_id='+data.info.comment_id+']').removeClass('enable').addClass('hadAgree');
                                $('.comment_disagree_img[comment_id='+data.info.comment_id+']').removeClass('enable');
                                var agree_num = $('.comment_agree_num[comment_id='+data.info.comment_id+']').attr('agree_num');
                                agree_num = parseInt(agree_num) + 1;
                                $('.comment_agree_num[comment_id='+data.info.comment_id+']').html(agree_num).addClass('hadAgree');

                                layer.msg('操作成功！');                                    
                            }else{
                                layer.msg(data.info);
                            }
                        })
                   },
                   '.comment_disagree_img.enable' : function(){
                        var comment_id = $(this).attr('comment_id');
                        $.post('/Article/addCommentDisagree',{comment_id : comment_id},function(data){
                            if(data.status){
                                  //将该点赞按钮和点踩按钮变成不可点击
                                $('.comment_agree_img[comment_id='+data.info.comment_id+']').removeClass('enable');
                                $('.comment_disagree_img[comment_id='+data.info.comment_id+']').removeClass('enable').addClass('hadDisagree');
                                var disagree_num = $('.comment_disagree_num[comment_id='+data.info.comment_id+']').attr('disagree_num');
                                disagree_num = parseInt(disagree_num) + 1;
                                $('.comment_disagree_num[comment_id='+data.info.comment_id+']').html(disagree_num).addClass('hadAgree');

                                layer.msg('操作成功！');                                 
                            }else{
                                layer.msg(data.info);
                            }
                        })
                   }
                }
            })          
        })
    </script>
    </html>
